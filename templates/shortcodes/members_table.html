{% import "macros/media.html" as media %}

<table class="table w-100">
  <colgroup>
    <col width="20%">
    <col width="40%">
    <col width="40%">
  </colgroup>
  <thead class="font-sans">
    <tr>
      <td></td>
      <th scope="col">Initiative</th>
      <th scope="col">Representative(s)</th>
    </tr>
  </thead>
  <tbody>
    {% set data = load_data(path=data_path) %}
    {%- for place in data.place | sort(attribute="lon") | reverse %}
      {%- for initiative in place.initiative | sort(attribute="name") %}
        {%- for person in initiative.person | sort(attribute="name") %}
          <tr>
            {% if loop.index == 1 %}
            <td
              {%- if initiative.person | length > 1 %} rowspan="{{ initiative.person | length }}"{% endif -%}
            >
              <div
                class="rounded my-1"
                style="background-color: rgba(0, 0, 0, 0.125); position: relative"
              >
                {% if initiative.image -%}
                  {{-
                    media::picture_fill(
                      img=initiative.image,
                      widths=[160, 320],
                      heights=[90, 180],
                      class="rounded shadow-sm",
                      attrs="width='160'"
                    )
                  -}}
                {%- endif %}
                {% if initiative.video -%}
                <i
                  class="fas fa-play-circle text-light"
                  style="opacity: 0.25; font-size:3rem; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);"
                ></i>
                {%- endif %}
              </div>
            </td>
            <th
              scope="row"
              class="pe-3"
              {%- if initiative.person | length > 1 %} rowspan="{{ initiative.person | length }}"{% endif -%}
            >
              <div class="float-md-end ms-4">
                {% if initiative.url -%}
                  <a href="{{ initiative.url }}" target="_blank" rel="noopener noreferrer" class="text-decoration-none mx-1">
                    <i class="fas fa-globe-europe fa-sm"></i>
                  </a>
                {%- endif %}
                {% if initiative.email -%}
                  <a href="mailto:{{ initiative.email }}" class="text-decoration-none mx-1">
                    <i class="fas fa-envelope-open-text fa-sm"></i>
                  </a>
                {%- endif %}
                {% if initiative.twitter -%}
                  <a href="https://twitter.com/{{ initiative.twitter }}" target="_blank" rel="noopener noreferrer" class="text-decoration-none mx-1">
                    <i class="fab fa-twitter fa-sm"></i>
                  </a>
                {%- endif %}
              </div>
              {{- initiative.name -}}
              {% if initiative.institution %}
                <br>
                <small class="text-muted fw-normal">
                  {{ initiative.institution }}
                </small>
              {% endif %}
            </th>
            {% endif %}
            <td>
              {{ person.name }}
              <div class="float-md-end">
                {% if person.url -%}
                  <a href="{{ person.url }}" target="_blank" rel="noopener noreferrer"  class="text-decoration-none mx-1">
                    <i class="fas fa-globe-europe fa-sm"></i>
                  </a>
                {%- endif %}
                {% if person.email -%}
                  <a href="mailto:{{ person.email }}" class="text-decoration-none mx-1">
                    <i class="fas fa-envelope-open-text fa-sm"></i>
                  </a>
                {%- endif %}
                {% if person.twitter -%}
                  <a href="https://twitter.com/{{ person.twitter }}" target="_blank" rel="noopener noreferrer" class="text-decoration-none mx-1">
                    <i class="fab fa-twitter fa-sm"></i>
                  </a>
                {%- endif %}
              </div>
            </td>
          </tr>
        {% endfor -%}
      {% endfor -%}
    {% endfor -%}
  </tbody>
</table>
